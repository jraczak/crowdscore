<script src="http://maps.googleapis.com/maps/api/js?v=3&libraries=geometry&sensor=true" type="text/javascript"></script>

<!-- Search results google map, place google map within this -->
<div id="search-results-map" class="search-results-map">
</div>
<div class="search-results-bank">
	<div class="results-header">
		<p class="result-count"><%= pluralize(collection.results.count, "Result") %></p>
		<span class="results-filter-dropdown">
			<span class="filter-dropdown-value">Sort By</span>
			<span class="filter-dropdown-arrow"><i class="fa fa-angle-down"></i></span>
		</span>
	</div>
	<% collection.results.each_with_index do |venue, index| %>
		<%= render 'search_result', venue: venue, index: index %>
	<% end %>
</div>

<script type="text/javascript">
	$(document).ready(function(){
		google.maps.event.addDomListener(window, 'load', function(){
			map = new Gmap(<%= raw @json %>);
		});
	})
</script>
<!-- 
<% if collection.hits.any? %>
  <div>
    <h4>We found <%= pluralize(collection.results.count, "result") %> for <%= params[:q] %> near <%= params[:id] %></h4>
    
    <div>
      <% collection.results.each do |v| %>
        <div>
	        <h3><%= link_to v.name, v %></h3>
	        <% if v.score.class == Fixnum %>
	          <h4><%= v.score %></h4>
	        <% else %>
	          <h4>NA</h4>
	        <% end %>
	        <h4><%= v.full_category_name %></h4>
	        <h4 data-lat=<%= v.latitude %> data-long=<%= v.longitude %>>
	        <% unless v.tips.empty? %>
	          <p>"<%= v.recent_tip.text %>"<br>
	          <%= link_to v.recent_tip.user.username, v.recent_tip.user %> | <%= time_ago_in_words(v.recent_tip.created_at) %> ago</p>
	        <% end %>
	    </div>
	  <% end %>
<% else %>
  <p>Bummer. We couldn't find a venue that matched your search for "<%= params[:q] %>".</p><br>
  <p>You can either <%= link_to "add a new venue", new_venue_path %> for some serious karma (this requires signing in), <%= link_to "search again", root_path %>, or <%= mail_to "support@crowdsco.re", "shoot us an email", subject: "Request to add a new venue" %> with some info about the venue and we'll get it added for you.</p>
<% end %>
	        
        
    </div>
  </div>
