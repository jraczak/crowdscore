(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},o={}.hasOwnProperty,n=function(t,e){function n(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};CS.TagModalView=function(o){function r(){return this.resetFooter=e(this.resetFooter,this),this.addTag=e(this.addTag,this),this.updateTagIdDropdown=e(this.updateTagIdDropdown,this),this.newTagForm=e(this.newTagForm,this),this.renderTagCollection=e(this.renderTagCollection,this),t=r.__super__.constructor.apply(this,arguments)}return n(r,o),r.prototype.el="#tag-modal",r.prototype.content_el="#tag-modal .content",r.prototype.footer_el="#tag-modal .modal-footer",r.prototype.events={hide:"resetHash","click #new_tag":"newTagForm","click #done_with_tags":"hideModal","submit .modal-footer form":"addTag","click .modal-footer button.cancel":"resetFooter","change select#tag_category_id":"updateTagIdDropdown"},r.prototype.initialize=function(){return null==this.id?(console.log("Must initialize with venue id."),!1):(this.$el=$(this.el),this.$content_el=$(this.content_el),this.$footer=$(this.footer_el),this.render())},r.prototype.render=function(){return this.displayModal(),this.setupTagDisplay()},r.prototype.displayModal=function(){return this.$el.modal({backdrop:!0,show:!0})},r.prototype.setupTagDisplay=function(){return this.collection=new TagCollection,this.collection.setVenueId(this.id),this.setBindings(),this.collection.fetch()},r.prototype.setBindings=function(){var t=this;return this.collection.bind("reset",function(){return t.renderTagCollection(),t.resetFooter()})},r.prototype.renderTagCollection=function(){return this.collection.length>0?this.$content_el.html(JST["templates/tag_display"]({tag_categories:this.collection.byCategory()})):this.$content_el.html(JST["templates/no_tags"]())},r.prototype.newTagForm=function(){var t=this;return this.allTags=new TagCollection,this.allTags.exclude(this.collection.pluck("id")),this.allTags.fetch({success:function(){return t.defaultFooter=t.$footer.html(),t.$footer.html(JST["templates/add_tag_form"]({venue_id:t.id,tag_categories:t.allTags.byCategory()})),t.$footer.find("input").focus()}}),!1},r.prototype.updateTagIdDropdown=function(){var t,e,o=this;return t=parseInt($("select#tag_category_id").val()),e=this.allTags.select(function(e){var n;return e.categoryId()===t&&(n=e.get("id"),i.call(o.allTags.excluded_ids,n)<0)}),$("select#tag_id").html(JST["templates/tag_id_option"]({tags:e}))},r.prototype.addTag=function(t){var e;return e=$(t.target).find("#tag_id").val(),this.collection.addToVenue(e),!1},r.prototype.resetFooter=function(){return this.$footer.html(this.defaultFooter),!1},r.prototype.hideModal=function(){return this.$el.modal("hide")},r.prototype.resetHash=function(){return location.hash="#"},r}(Backbone.View)}).call(this);