(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,o=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},r=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};CS.ListModalView=function(i){function n(){return this.renderSignupNotification=e(this.renderSignupNotification,this),this.resetFooter=e(this.resetFooter,this),this.createList=e(this.createList,this),this.newListForm=e(this.newListForm,this),this.addOrRemoveFromList=e(this.addOrRemoveFromList,this),this.createListPicker=e(this.createListPicker,this),this.renderListCollection=e(this.renderListCollection,this),t=n.__super__.constructor.apply(this,arguments)}return o(n,i),n.prototype.el="#lists-modal",n.prototype.content_el="#lists-modal .content",n.prototype.footer_el="#lists-modal .modal-footer",n.prototype.events={hide:"resetHash","click #new_list":"newListForm","click #done_with_lists":"hideModal","submit .modal-footer form":"createList","click .modal-footer button.cancel":"resetFooter","click .modal-footer button.cancel":"resetFooter","change .picker input":"addOrRemoveFromList"},n.prototype.initialize=function(){return null==this.id?(console.log("Must initialize with venue id."),!1):(this.$el=$(this.el),this.$content_el=$(this.content_el),this.$footer=$(this.footer_el),this.render())},n.prototype.render=function(){return this.displayModal(),this.setupListDisplay()},n.prototype.displayModal=function(){return this.$el.modal({backdrop:!0,show:!0})},n.prototype.setupListDisplay=function(){return this.collection=new ListCollection,this.setBindings(),this.collection.fetch({error:this.renderSignupNotification})},n.prototype.setBindings=function(){var t=this;return this.collection.bind("reset",this.renderListCollection),this.collection.bind("add",function(){return t.renderListCollection(),t.resetFooter()})},n.prototype.renderListCollection=function(){var t,e=this;return this.$content_el.html(JST["templates/list_modal_instructions"]()),t=$.map(this.collection.models,this.createListPicker),$.each(t,function(t,i){return e.$content_el.find("#pickers").append(i)})},n.prototype.createListPicker=function(t){var e,i;return i=parseInt(this.id),e=r.call(t.get("venue_ids"),i)>=0?' checked="checked"':"",JST["templates/list_picker"]({name:t.get("name"),checked:e,id:t.get("id")})},n.prototype.addOrRemoveFromList=function(t){var e,i,o;return e=$(t.target),i=parseInt(e.parents("p").data("id")),console.log(i),o=this.collection.find(function(t){return i===parseInt(t.get("id"))}),e.attr("checked")?o.addVenue(this.id):o.removeVenue(this.id)},n.prototype.newListForm=function(){return this.defaultFooter=this.$footer.html(),this.$footer.html(JST["templates/new_list_form_for_modals"]({venue_id:this.id})),this.$footer.find("input").focus(),!1},n.prototype.createList=function(t){var e;return e=$(t.target).find("#list_name").val(),this.collection.create({list:{name:e,venue_ids:[this.id]}},{wait:!0}),!1},n.prototype.resetFooter=function(){return this.$footer.html(this.defaultFooter),!1},n.prototype.renderSignupNotification=function(){return this.$content_el.html(JST["templates/modal_signup_note"]({location:location.href}))},n.prototype.hideModal=function(){return this.$el.modal("hide")},n.prototype.resetHash=function(){return location.hash="#"},n}(Backbone.View)}).call(this);